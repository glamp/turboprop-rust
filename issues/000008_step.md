# Step 8: Search Command Implementation with Output Formatting

## Objective
Implement the complete `tp search` command with JSON and human-readable output formats.

## Tasks
1. Wire together query processing, search, and result formatting
2. Implement line-delimited JSON output format for LLM consumption
3. Add human-readable text output format
4. Support filetype filtering
5. Add result ranking and presentation
6. Create comprehensive search tests

## Technical Approach
- Load existing index from `.turboprop/` directory
- Process search query through embedding pipeline
- Format results according to specified output mode
- Support both streaming and batch result output
- Include file context (surrounding lines) in results

## Acceptance Criteria
- `tp search "query" --repo .` returns relevant results from poker codebase
- Default JSON output is line-delimited for easy LLM parsing
- `--output text` provides human-readable formatted results
- `--filetype .js` correctly filters results by file extension
- Results include file path, line numbers, similarity score, and content
- No results found case handled gracefully
- Results are ranked by relevance (similarity score)
- Fast search performance on indexed data

## CLI Integration
```bash
# JSON output (default)
tp search "jwt authentication" --repo .
{"file":"src/auth.js","line_start":15,"line_end":18,"score":0.87,"content":"..."}

# Human-readable output
tp search "jwt authentication" --repo . --output text
# ðŸ“„ src/auth.js:15-18 (similarity: 87%)
# const token = jwt.sign(payload, secret);
# if (!token) throw new Error('Failed to generate token');

# Filetype filtering
tp search --filetype .ts "interface" --repo .
```

## Files Created/Modified
- `src/commands/search.rs` - Search command implementation
- `src/output.rs` - Result formatting and output
- `src/filters.rs` - Search result filtering
- `tests/integration/search_tests.rs` - End-to-end search tests

## Test Cases
- Test search with known queries against poker codebase
- Test JSON output format for LLM consumption
- Test human-readable text output format
- Test filetype filtering functionality
- Test result ranking and scoring
- Test no results found scenarios
- Verify search performance and accuracy