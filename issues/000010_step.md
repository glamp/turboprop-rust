# Step 10: File Watching and Incremental Index Updates

## Objective
Implement `--watch` mode for automatic index updates when files change.

## Tasks
1. Add file system watching using notify crate
2. Implement incremental index updates (add/remove/modify files)
3. Handle batch file change events efficiently
4. Add debouncing to avoid excessive updates
5. Gracefully handle watch mode interruption
6. Create comprehensive watch mode tests

## Technical Approach
- Use `notify` crate for cross-platform file watching
- Watch only git-tracked files and respect .gitignore changes
- Batch file events with 500ms debouncing
- Incremental updates: remove old chunks, add new chunks for changed files
- Atomic index updates to maintain consistency

## Dependencies to Add
- `notify` - File system watching
- `signal-hook` - Signal handling for graceful shutdown

## Acceptance Criteria
- `tp index --watch --repo .` continuously monitors for file changes
- File modifications trigger incremental index updates
- New files are automatically added to index
- Deleted files are removed from index
- Batch processing of multiple simultaneous changes
- Graceful shutdown on Ctrl+C
- Watch mode respects .gitignore changes
- Index remains consistent during concurrent operations

## CLI Integration
```bash
tp index --watch --repo .
# Indexing repository... âœ“ Processed 12 files
# Watching for changes... (Press Ctrl+C to stop)
# File modified: src/auth.ts (reindexing...)
# File added: src/new-feature.ts (indexing...)
# File deleted: src/old-code.ts (removing from index...)
```

## Files Created/Modified
- `src/watcher.rs` - File system watching implementation
- `src/incremental.rs` - Incremental index update logic
- `src/commands/index.rs` - Add watch mode support
- `tests/watch_tests.rs` - File watching tests

## Test Cases
- Test file modification detection and reindexing
- Test new file addition to index
- Test file deletion from index
- Test batch change processing
- Test graceful shutdown
- Test watch mode with gitignore changes
- Test concurrent index access during updates