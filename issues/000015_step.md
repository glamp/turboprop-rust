# Step 15: Extend CLI with --filter Flag

## Objective
Add the `--filter` command-line argument to the search command and integrate it with the search configuration system.

## Tasks
1. Add `--filter` argument to the Search command in cli.rs
2. Update SearchCommandConfig to include glob pattern parameter
3. Add CLI argument validation and help text
4. Update search command execution to pass glob pattern through
5. Add tests for CLI argument parsing with glob patterns

## Background
Building on Step 14's foundation, this step adds the user-facing CLI interface for the glob pattern filtering feature as specified: `tp search "jwt authentication" --repo . --filter src/*.js`

## Implementation Details

### 1. CLI Changes in src/cli.rs
Add to the Search command:
```rust
/// Filter results by file glob pattern (e.g., "src/*.js", "**/*.rs")
#[arg(long)]
filter: Option<String>,
```

### 2. SearchCommandConfig Updates in src/commands/search.rs
- Add `pub glob_pattern: Option<String>` field
- Update constructor to accept glob pattern parameter
- Update validation to validate glob pattern using Step 14's validation function
- Add glob pattern to debug output and logging

### 3. CLI Integration
- Update `execute_search_command_cli` function to pass filter parameter
- Ensure glob pattern is properly validated during CLI parsing
- Add helpful error messages for invalid glob patterns

### 4. Help Text and Documentation
Add comprehensive help text for the `--filter` flag:
- Clear description of glob pattern syntax
- Examples: `*.rs`, `src/*.js`, `test/**/*.py`
- Note about case sensitivity and relative path behavior

## Test Coverage
Add tests for:
- CLI parsing with valid glob patterns
- CLI parsing with invalid glob patterns  
- SearchCommandConfig creation with glob patterns
- Configuration validation with glob patterns
- Help text generation includes filter flag

## Acceptance Criteria
- [ ] `--filter` flag added to Search command
- [ ] SearchCommandConfig extended with glob_pattern field
- [ ] CLI argument validation uses Step 14's validation function
- [ ] Helpful error messages for invalid patterns
- [ ] Help text clearly explains glob pattern usage with examples
- [ ] All existing CLI functionality preserved
- [ ] Tests cover both valid and invalid pattern scenarios
- [ ] `cargo build` succeeds without warnings
- [ ] `cargo test` passes all tests

## Files to Create/Modify
- `src/cli.rs` - Add --filter argument to Search command
- `src/commands/search.rs` - Update SearchCommandConfig and validation
- `src/commands/search.rs` - Add test cases for CLI integration

## Success Validation
Run these commands to validate the step:
```bash
cargo build
cargo test search::test_search_command_config
./target/debug/tp search --help  # Verify --filter flag appears
cargo fmt --check
```

## Example Usage After This Step
```bash
# These should parse successfully (but filtering not yet implemented)
tp search "test" --filter "*.rs"
tp search "authentication" --filter "src/*.js" 
tp search "config" --filter "**/test_*.py"

# These should show helpful error messages
tp search "test" --filter ""
tp search "test" --filter "[invalid"
```

## Notes
This step focuses solely on CLI interface and configuration - the actual glob filtering logic will be implemented in Step 16. The search should accept the glob pattern but not yet apply the filtering.

## Proposed Solution

I have implemented the CLI interface for glob pattern filtering by:

### 1. CLI Changes
- Added `filter: Option<String>` field to the Search command in `src/cli.rs`
- Added comprehensive help text explaining glob pattern syntax with examples

### 2. SearchCommandConfig Updates  
- Extended `SearchCommandConfig` struct with `pub glob_pattern: Option<String>` field
- Updated constructor to accept the glob pattern parameter
- Enhanced validation to use Step 14's `validate_glob_pattern()` function
- Added glob pattern logging for debugging

### 3. CLI Integration
- Updated `execute_search_command_cli` function to accept and pass through filter parameter
- Updated main.rs to extract filter parameter from CLI args
- Ensured proper parameter validation during CLI parsing

### 4. Comprehensive Testing
- Updated all existing tests to account for new glob_pattern parameter
- Added specific test cases for:
  - Valid glob pattern validation (`*.rs`, `src/*.js`, `**/*.py`)
  - Invalid glob pattern validation (empty strings, malformed patterns)
  - Configuration with both filetype and glob pattern filters
  - Configuration with no glob pattern (None case)
- Updated all integration tests to pass the new filter parameter

### 5. Error Handling
- Leveraged existing comprehensive error messages from Step 14's validation
- Added contextual error information for glob pattern validation failures
- Maintained backward compatibility with existing CLI functionality

The implementation properly separates CLI interface concerns from filtering logic, setting up the foundation for Step 16's actual glob pattern filtering implementation.