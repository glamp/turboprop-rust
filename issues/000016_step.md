# Step 16: Implement Core Glob Filtering Logic

## Objective
Implement the core glob pattern matching logic within the SearchFilter system to actually filter search results by file path patterns.

## Tasks
1. Extend FilterConfig with glob pattern field
2. Implement glob pattern matching in SearchFilter
3. Integrate glob filtering with existing file extension filtering
4. Add comprehensive tests for glob pattern matching logic
5. Ensure proper error handling and logging

## Background
Building on Steps 14-15, this step implements the actual filtering logic that matches file paths against glob patterns using the `glob` crate's pattern matching capabilities.

## Implementation Details

### 1. FilterConfig Extensions in src/filters.rs
Add new field and methods:
```rust
pub struct FilterConfig {
    pub file_extension: Option<String>,
    pub glob_pattern: Option<String>,  // New field
}

impl FilterConfig {
    pub fn with_glob_pattern(mut self, pattern: String) -> Self {
        self.glob_pattern = Some(pattern);
        self
    }
}
```

### 2. SearchFilter Implementation
Add methods to SearchFilter:
- `filter_by_glob_pattern()` - Core filtering logic using glob::Pattern
- `matches_glob_pattern()` - Check if single file path matches pattern
- Update `apply_filters()` to apply both extension and glob filters
- Update `from_cli_args()` to accept glob pattern parameter
- Update `describe_filters()` and `has_active_filters()` for glob patterns

### 3. Glob Pattern Matching Logic
Implement robust pattern matching:
- Use `glob::Pattern::new()` for pattern compilation
- Handle both absolute and relative path patterns
- Support common patterns: `*.ext`, `dir/*.ext`, `**/pattern`, `dir/**/file.ext`
- Case-sensitive matching (consistent with Unix shell behavior)
- Proper error handling for invalid patterns at runtime

### 4. Filter Integration
Ensure proper interaction between filters:
- Both glob and extension filters can be active simultaneously  
- Apply filters in logical order (glob first, then extension)
- Maintain existing filter behavior for backward compatibility
- Log which filters are active and how many results each step filters

## Test Coverage
Add comprehensive tests for:
- Basic glob patterns: `*.rs`, `*.js`, `*.py`
- Directory patterns: `src/*.rs`, `tests/*.rs`
- Recursive patterns: `**/*.rs`, `src/**/*.js`
- Combined patterns: `src/**/*test*.rs`
- Non-matching patterns (empty results)
- Invalid patterns at runtime (should be caught earlier, but defensive)
- Interaction with existing file extension filters
- Case sensitivity behavior
- Edge cases: files without extensions, deep paths, special characters

## Performance Considerations
- Compile glob patterns once and reuse
- Efficient path matching using glob crate's optimized algorithms
- Consider caching compiled patterns if needed
- Log performance impact of glob filtering

## Acceptance Criteria
- [ ] FilterConfig extended with glob_pattern field
- [ ] SearchFilter implements glob pattern matching
- [ ] Core `filter_by_glob_pattern()` method works correctly
- [ ] Integration with existing file extension filtering
- [ ] Comprehensive test coverage for all pattern types
- [ ] Proper error handling and logging
- [ ] Performance acceptable for typical codebases
- [ ] All existing tests continue to pass
- [ ] `cargo build` succeeds without warnings

## Files to Create/Modify
- `src/filters.rs` - Extend FilterConfig and SearchFilter with glob support
- `src/filters.rs` - Add comprehensive test cases for glob filtering

## Success Validation
Run these commands to validate the step:
```bash
cargo build
cargo test filters::test_glob_filtering
cargo test filters::test_combined_filters
cargo fmt --check
```

## Test Examples
The tests should verify patterns like:
```rust
// Basic patterns
assert_matches_glob("src/main.rs", "*.rs");
assert_matches_glob("src/main.rs", "src/*.rs");
assert_not_matches_glob("src/main.rs", "*.js");

// Recursive patterns  
assert_matches_glob("src/nested/deep/file.rs", "**/file.rs");
assert_matches_glob("tests/integration/search.rs", "tests/**/*.rs");

// Combined filtering
filter_with_glob_and_extension("src/*.rs", ".rs");
```

## Notes
After this step, the glob filtering will be functionally complete but not yet connected to the search command pipeline. Step 17 will integrate it with the actual search execution.