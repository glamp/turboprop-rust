# Step 34: Documentation and User Guide

## Objective
Create comprehensive documentation for the MCP server functionality, including user guides, setup instructions, and troubleshooting information.

## Background
The MCP server represents a significant new capability for TurboProp. Users need clear documentation to understand how to use it, integrate it with coding agents, and troubleshoot common issues. The documentation should follow TurboProp's existing patterns while being accessible to users who may be new to MCP.

## Tasks
1. Update README.md with MCP server documentation
2. Create dedicated MCP user guide 
3. Add troubleshooting section for MCP-specific issues
4. Update CLI help text and man pages
5. Add integration examples for popular coding agents

## Implementation Details

### 1. Update Main README.md

Add comprehensive MCP section to `README.md`:
```markdown
## MCP Server for Coding Agents

TurboProp includes a built-in MCP (Model Context Protocol) server that provides real-time semantic search capabilities to coding agents like Claude Code, GitHub Copilot, Cursor, and Windsurf.

### Quick Start

```bash
# Start MCP server for current directory
tp mcp --repo .

# Start with custom configuration
tp mcp --repo . --model sentence-transformers/all-MiniLM-L12-v2 --max-filesize 5mb
```

The server automatically:
- Indexes all files in the repository
- Watches for file changes and updates the index in real-time
- Exposes a `search` tool via the MCP protocol
- Provides semantic search across your entire codebase

### Integration with Coding Agents

#### Claude Code

Add to your `.claude.json` or MCP configuration:
```json
{
  "mcpServers": {
    "turboprop": {
      "command": "tp",
      "args": ["mcp", "--repo", "."]
    }
  }
}
```

#### Cursor

Add to `.cursor/mcp.json`:
```json
{
  "mcpServers": {
    "turboprop": {
      "command": "tp", 
      "args": ["mcp", "--repo", "."]
    }
  }
}
```

#### GitHub Copilot / Windsurf

Configure in your agent settings to use the turboprop MCP server:
- **Command**: `tp`
- **Arguments**: `["mcp", "--repo", "."]`

### Search Tool Parameters

The MCP server exposes a `search` tool with these parameters:

- **query** (required): Natural language search query
  - Examples: "JWT authentication", "error handling code", "database connection logic"
- **limit** (optional): Maximum results (default: 10, max: 100)
- **threshold** (optional): Similarity threshold 0.0-1.0 (default: from config)
- **filetype** (optional): Filter by extension (e.g., ".rs", ".js", ".py")
- **filter** (optional): Glob pattern filter (e.g., "src/**/*.rs", "tests/**")
- **include_content** (optional): Include full content in results (default: true)
- **context_lines** (optional): Context lines around matches (default: 0, max: 10)

### Example Usage

Once integrated with your coding agent, you can ask questions like:

- "Find the JWT authentication implementation"
- "Show me error handling patterns in this codebase"
- "Where is database connection logic defined?"
- "Find all tests related to user authentication"

The MCP server will search your entire codebase semantically and return relevant code snippets with file paths and line numbers.

### Configuration

The MCP server respects your existing `.turboprop.yml` configuration:

```yaml
# Example .turboprop.yml
model: "sentence-transformers/all-MiniLM-L6-v2"
max_filesize: "2mb"
default_limit: 10
similarity_threshold: 0.3

file_discovery:
  include_patterns:
    - "**/*.rs"
    - "**/*.js"
    - "**/*.py" 
    - "**/*.md"
  exclude_patterns:
    - "target/**"
    - "node_modules/**"
    - ".git/**"
```

For more details, see the [MCP User Guide](docs/MCP_GUIDE.md).
```

### 2. Create Dedicated MCP User Guide

Create `docs/MCP_GUIDE.md`:
```markdown
# TurboProp MCP Server User Guide

## Overview

The TurboProp MCP (Model Context Protocol) server enables seamless integration between TurboProp's semantic search capabilities and coding agents like Claude Code, GitHub Copilot, Cursor, and Windsurf.

This guide covers everything you need to know to set up, configure, and use the MCP server effectively.

## Table of Contents

1. [Installation and Setup](#installation-and-setup)
2. [Basic Usage](#basic-usage)
3. [Agent Integration](#agent-integration)
4. [Configuration](#configuration)
5. [Advanced Features](#advanced-features)
6. [Troubleshooting](#troubleshooting)
7. [Performance Optimization](#performance-optimization)

## Installation and Setup

### Prerequisites

- TurboProp installed and available in PATH
- A git repository or directory with code files
- A compatible coding agent (Claude Code, Cursor, GitHub Copilot, etc.)

### Quick Setup

1. **Navigate to your project directory:**
   ```bash
   cd /path/to/your/project
   ```

2. **Start the MCP server:**
   ```bash
   tp mcp --repo .
   ```

3. **Configure your coding agent** (see [Agent Integration](#agent-integration))

4. **Start coding!** Your agent can now search your codebase semantically.

## Basic Usage

### Starting the Server

```bash
# Basic usage - index current directory
tp mcp --repo .

# Specify a different directory
tp mcp --repo /path/to/project

# Use custom model
tp mcp --repo . --model sentence-transformers/all-MiniLM-L12-v2

# Set file size limit
tp mcp --repo . --max-filesize 5mb

# Force rebuild of index
tp mcp --repo . --force-rebuild

# Enable verbose logging
tp mcp --repo . --verbose
```

### Server Lifecycle

When you start the MCP server:

1. **Initial Indexing**: Scans all files and builds semantic index
2. **File Watching**: Monitors directory for changes
3. **Real-time Updates**: Updates index when files change
4. **Ready State**: Accepts search requests from agents

The server runs until you stop it (Ctrl+C) or the agent disconnects.

### Understanding the Output

```bash
$ tp mcp --repo .
ðŸš€ TurboProp MCP Server Started
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Repository: /Users/you/project
Configuration summary:
  Repository: /Users/you/project
  Model: sentence-transformers/all-MiniLM-L6-v2
  Max file size: 2mb
  Batch size: 32

MCP server ready and listening on stdio...
```

## Agent Integration

### Claude Code

**Method 1: Global Configuration**

Add to `~/.claude/mcp.json`:
```json
{
  "mcpServers": {
    "turboprop": {
      "command": "tp",
      "args": ["mcp", "--repo", "."],
      "env": {}
    }
  }
}
```

**Method 2: Project-specific Configuration**

Add to your project's `.claude.json`:
```json
{
  "mcpServers": {
    "turboprop": {
      "command": "tp",
      "args": ["mcp", "--repo", "."]
    }
  }
}
```

### Cursor

Add to `.cursor/mcp.json` in your project root:
```json
{
  "mcpServers": {
    "turboprop": {
      "command": "tp",
      "args": ["mcp", "--repo", "."],
      "cwd": "."
    }
  }
}
```

### GitHub Copilot

Configure via VS Code settings or your GitHub Copilot configuration:
```json
{
  "github.copilot.mcp.servers": [
    {
      "name": "turboprop",
      "command": "tp",
      "args": ["mcp", "--repo", "."]
    }
  ]
}
```

### Windsurf

Add to your Windsurf project configuration:
```json
{
  "mcp": {
    "servers": {
      "turboprop": {
        "command": "tp",
        "args": ["mcp", "--repo", "."]
      }
    }
  }
}
```

## Configuration

### Command Line Options

| Option | Description | Example |
|--------|-------------|---------|
| `--repo` | Repository path to index | `--repo /path/to/project` |
| `--model` | Embedding model to use | `--model sentence-transformers/all-MiniLM-L12-v2` |
| `--max-filesize` | Maximum file size to index | `--max-filesize 5mb` |
| `--filter` | Glob pattern for files to include | `--filter "src/**/*.rs"` |
| `--filetype` | Filter by file type | `--filetype rust` |
| `--force-rebuild` | Force rebuild of existing index | `--force-rebuild` |
| `--verbose` | Enable verbose logging | `--verbose` |
| `--debug` | Enable debug logging | `--debug` |

### Configuration File

Create `.turboprop.yml` in your project root:

```yaml
# Model configuration
model: "sentence-transformers/all-MiniLM-L6-v2"
cache_dir: "~/.turboprop-cache"

# File discovery settings
max_filesize: "2mb"
file_discovery:
  include_patterns:
    - "**/*.rs"
    - "**/*.js" 
    - "**/*.ts"
    - "**/*.py"
    - "**/*.java"
    - "**/*.go"
    - "**/*.md"
  exclude_patterns:
    - "target/**"
    - "node_modules/**"
    - ".git/**"
    - "*.log"
  
# Search settings  
search:
  default_limit: 10
  similarity_threshold: 0.3

# Embedding settings
embedding:
  batch_size: 32
  cache_embeddings: true

# MCP server settings
mcp:
  enable_file_watching: true
  update_debounce_ms: 500
  max_concurrent_searches: 10
```

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `TURBOPROP_CACHE_DIR` | Cache directory for models | `~/.turboprop-cache` |
| `TURBOPROP_LOG_LEVEL` | Log level (error, warn, info, debug) | `info` |
| `RUST_LOG` | Rust logging configuration | - |

## Advanced Features

### Model Selection

Choose the right model for your use case:

```bash
# Fast, lightweight (default)
tp mcp --repo . --model sentence-transformers/all-MiniLM-L6-v2

# Better accuracy
tp mcp --repo . --model sentence-transformers/all-MiniLM-L12-v2

# Code-specific model (when available)
tp mcp --repo . --model nomic-embed-code.Q5_K_S.gguf

# Multilingual support (when available)
tp mcp --repo . --model Qwen/Qwen3-Embedding-0.6B
```

### File Filtering

Control which files are indexed:

```bash
# Only Rust files
tp mcp --repo . --filter "**/*.rs"

# Multiple patterns in config file
# .turboprop.yml:
file_discovery:
  include_patterns:
    - "src/**/*.rs"
    - "lib/**/*.rs" 
    - "tests/**/*.rs"
  exclude_patterns:
    - "target/**"
    - "**/*_generated.rs"
```

### Performance Tuning

For large repositories:

```yaml
# .turboprop.yml
embedding:
  batch_size: 16  # Reduce for lower memory usage
  
file_discovery:
  max_filesize: "1mb"  # Skip very large files
  
mcp:
  update_debounce_ms: 1000  # Reduce update frequency
```

## Troubleshooting

### Common Issues

#### Server Won't Start

**Symptom**: Server fails to start with error message
```
Error: Repository path does not exist: /path/to/project
```

**Solution**: 
- Verify the path exists and is accessible
- Use absolute paths if relative paths don't work
- Check directory permissions

#### Agent Can't Connect

**Symptom**: Agent reports "MCP server not available" or similar
```
MCP connection failed: turboprop server not responding
```

**Solutions**:
1. Verify the server is running: `ps aux | grep "tp mcp"`
2. Check agent configuration syntax
3. Ensure `tp` command is in PATH
4. Try starting server manually: `tp mcp --repo . --verbose`

#### Search Returns No Results

**Symptom**: Searches return empty results even for known content

**Solutions**:
1. Wait for indexing to complete (check server logs)
2. Verify files are being indexed: `tp mcp --repo . --verbose`
3. Try rebuilding index: `tp mcp --repo . --force-rebuild`
4. Check file filters in configuration

#### High Memory Usage

**Symptom**: Server uses excessive memory

**Solutions**:
1. Reduce batch size in configuration
2. Set lower max file size limit
3. Use more restrictive file patterns
4. Consider using a different model

### Debug Mode

Enable detailed logging:

```bash
# Enable debug logging
tp mcp --repo . --debug

# Enable Rust debug logging
RUST_LOG=debug tp mcp --repo .

# Log to file (stderr only, stdout is used for MCP)
tp mcp --repo . --verbose 2> mcp-server.log
```

### Performance Issues

**Symptoms**:
- Slow search responses
- High CPU usage
- Frequent index updates

**Solutions**:
1. **Optimize file patterns**:
   ```yaml
   file_discovery:
     exclude_patterns:
       - "target/**"      # Build artifacts
       - "node_modules/**" # Dependencies
       - "*.log"          # Log files
       - "**/*.min.js"    # Minified files
   ```

2. **Adjust update settings**:
   ```yaml
   mcp:
     update_debounce_ms: 2000  # Wait longer before updates
     max_concurrent_searches: 5  # Limit concurrent operations
   ```

3. **Use appropriate model**:
   - Smaller models for faster responses
   - Larger models for better accuracy

### Getting Help

If you encounter issues not covered here:

1. **Check server logs** with `--verbose` or `--debug`
2. **Search existing issues** on GitHub
3. **Create a new issue** with:
   - TurboProp version (`tp --version`)
   - Operating system
   - Agent type and version
   - Configuration files
   - Server logs
   - Steps to reproduce

## Performance Optimization

### Repository Size Guidelines

| Repository Size | Recommended Settings |
|----------------|---------------------|
| Small (< 1k files) | Default settings |
| Medium (1k-10k files) | `batch_size: 16`, `max_filesize: "1mb"` |
| Large (10k+ files) | `batch_size: 8`, aggressive filtering, consider watchman |

### Memory Usage

Monitor memory usage and adjust:

```bash
# Monitor memory usage
ps aux | grep "tp mcp"

# Reduce memory usage
tp mcp --repo . --max-filesize 500kb --filter "src/**/*.rs"
```

### Search Performance

Optimize search performance:

1. **Set appropriate similarity thresholds**
2. **Use specific file type filters**
3. **Limit result counts**
4. **Use targeted queries**

Example optimized search parameters:
```json
{
  "query": "authentication JWT validation",
  "limit": 5,
  "threshold": 0.6,
  "filetype": ".rs",
  "filter": "src/**/*.rs"
}
```

## Best Practices

### 1. Repository Organization

- Keep code organized in clear directory structures
- Use meaningful file names and comments
- Avoid deeply nested directory structures

### 2. Configuration Management

- Use `.turboprop.yml` for project-specific settings
- Version control your configuration
- Document any special configuration requirements

### 3. Agent Integration

- Test integration with a simple query first
- Use descriptive search queries for better results
- Take advantage of file type and pattern filtering

### 4. Maintenance

- Regularly update TurboProp to get latest improvements
- Monitor server performance and adjust configuration as needed
- Keep an eye on disk usage for cache and index files

### 5. Team Usage

- Share configuration files with team members
- Document any special setup requirements
- Consider using consistent model choices across team

## FAQ

**Q: Can I run multiple MCP servers for different projects?**
A: Yes, each server operates independently. Start each with its own `--repo` path.

**Q: Does the server work with remote repositories?**
A: The server indexes local files only. Clone the repository locally first.

**Q: Can I exclude certain file types?**
A: Yes, use `exclude_patterns` in your configuration file.

**Q: How often does the index update?**
A: The server watches for file changes and updates incrementally, typically within 1-2 seconds.

**Q: What happens if I modify a file while the server is running?**
A: The server automatically detects changes and updates the relevant parts of the index.

**Q: Can I use custom models?**
A: Currently, TurboProp supports specific pre-trained models. Check the model documentation for available options.

**Q: Is there a limit to repository size?**
A: No hard limit, but performance depends on your system resources. Use filtering for very large repositories.

For more questions, see the [main TurboProp documentation](../README.md) or [file an issue](https://github.com/turboprop-org/turboprop/issues).
```

### 3. Update CLI Help Text

Update the help text in `src/cli.rs`:
```rust
/// Start MCP server for real-time semantic search
/// 
/// The MCP (Model Context Protocol) server enables integration with coding
/// agents like Claude Code, GitHub Copilot, Cursor, and Windsurf. It provides
/// real-time semantic search capabilities over your codebase.
/// 
/// The server will:
/// â€¢ Automatically index all files in the specified repository
/// â€¢ Watch for file changes and update the index in real-time  
/// â€¢ Expose a 'search' tool via the MCP protocol
/// â€¢ Support natural language queries across your entire codebase
/// 
/// Setup Instructions:
/// 1. Start the server: tp mcp --repo .
/// 2. Configure your coding agent to use the MCP server
/// 3. Ask your agent to search your code using natural language
/// 
/// For detailed setup instructions, see: https://github.com/turboprop-org/turboprop/blob/main/docs/MCP_GUIDE.md
/// 
/// Examples:
///   tp mcp --repo .                           # Index current directory
///   tp mcp --repo /path/to/project           # Index specific project
///   tp mcp --repo . --verbose                # Enable verbose logging
///   tp mcp --repo . --force-rebuild          # Force rebuild index
///   tp mcp --repo . --filter "src/**/*.rs"   # Only index Rust files
Mcp(McpArgs),
```

### 4. Add Troubleshooting Section

Update `TROUBLESHOOTING.md` to include MCP-specific issues:
```markdown
# MCP Server Troubleshooting

## MCP Server Issues

### Server Won't Start

**Error**: `Repository path does not exist`
```
Error: Repository path does not exist: /path/to/project
```

**Solutions**:
- Verify the path exists: `ls -la /path/to/project`
- Use absolute paths instead of relative paths
- Check directory permissions: `ls -ld /path/to/project`

**Error**: `Failed to create file watcher`
```
Error: Failed to create file watcher: too many open files
```

**Solutions**:
- Increase file descriptor limit: `ulimit -n 4096`
- Add to shell profile: `echo 'ulimit -n 4096' >> ~/.bashrc`
- On macOS, check system limits: `launchctl limit maxfiles`

### Agent Integration Issues

**Problem**: Agent can't connect to MCP server

**Symptoms**:
- "MCP server not available" 
- "Connection refused"
- "Server timeout"

**Solutions**:
1. **Verify server is running**:
   ```bash
   ps aux | grep "tp mcp"
   ```

2. **Check agent configuration**:
   - Verify JSON syntax in MCP config file
   - Ensure `tp` command is in PATH
   - Try absolute path to `tp` binary

3. **Test server manually**:
   ```bash
   tp mcp --repo . --verbose
   ```

4. **Check agent logs** for specific error messages

### Search Issues

**Problem**: Search returns no results

**Debugging steps**:
1. **Wait for indexing to complete**:
   ```bash
   tp mcp --repo . --verbose
   # Look for "Index initialization completed" message
   ```

2. **Verify files are being indexed**:
   ```bash
   tp mcp --repo . --debug 2>debug.log
   # Check debug.log for file discovery logs
   ```

3. **Test with known content**:
   - Search for exact strings that exist in your code
   - Try broader queries

4. **Check file filters**:
   - Review `.turboprop.yml` include/exclude patterns
   - Test without filters: `tp mcp --repo . --force-rebuild`

**Problem**: Search results are irrelevant

**Solutions**:
1. **Increase similarity threshold**:
   ```yaml
   # .turboprop.yml
   search:
     similarity_threshold: 0.5  # Higher = more strict
   ```

2. **Use more specific queries**:
   - Instead of "function", use "authentication function"
   - Include context: "JWT token validation function"

3. **Filter by file type**:
   ```json
   {
     "query": "database connection",
     "filetype": ".rs",
     "limit": 10
   }
   ```

### Performance Issues

**Problem**: High memory usage

**Symptoms**:
- Server uses > 2GB RAM
- System becomes slow
- Out of memory errors

**Solutions**:
1. **Reduce batch size**:
   ```yaml
   # .turboprop.yml
   embedding:
     batch_size: 8  # Default is 32
   ```

2. **Limit file size**:
   ```bash
   tp mcp --repo . --max-filesize 500kb
   ```

3. **Use restrictive patterns**:
   ```yaml
   file_discovery:
     include_patterns:
       - "src/**/*.rs"  # Only source files
     exclude_patterns:
       - "target/**"    # Exclude build artifacts
       - "*.log"        # Exclude logs
   ```

**Problem**: Slow search responses

**Solutions**:
1. **Use smaller model**:
   ```bash
   tp mcp --repo . --model sentence-transformers/all-MiniLM-L6-v2
   ```

2. **Limit concurrent searches**:
   ```yaml
   # .turboprop.yml
   mcp:
     max_concurrent_searches: 3
   ```

3. **Optimize queries**:
   - Use specific terms
   - Set appropriate limits
   - Filter by file type

### File Watching Issues

**Problem**: Index doesn't update when files change

**Debugging**:
1. **Check file watching logs**:
   ```bash
   tp mcp --repo . --debug 2>&1 | grep -i watch
   ```

2. **Test file changes**:
   - Make a simple change to a tracked file
   - Check if server logs show the change

3. **Verify file patterns**:
   - Ensure changed files match include patterns
   - Check that files aren't excluded

**Problem**: Too many file change events

**Symptoms**:
- High CPU usage
- Frequent index updates
- Server logs show constant file changes

**Solutions**:
1. **Increase debounce time**:
   ```yaml
   # .turboprop.yml
   mcp:
     update_debounce_ms: 2000  # Wait 2 seconds
   ```

2. **Exclude noisy directories**:
   ```yaml
   file_discovery:
     exclude_patterns:
       - "target/**"      # Build output
       - ".git/**"        # Git metadata
       - "node_modules/**" # Dependencies
       - "*.tmp"          # Temporary files
   ```

### Logging and Debugging

**Enable comprehensive logging**:
```bash
# Maximum debug output
RUST_LOG=debug tp mcp --repo . --debug 2>mcp-debug.log

# Focus on specific modules
RUST_LOG=turboprop::mcp=debug tp mcp --repo . 2>mcp-debug.log
```

**Useful log patterns to search for**:
- Index initialization: `grep -i "index.*init" mcp-debug.log`
- File changes: `grep -i "file.*change" mcp-debug.log`  
- Search queries: `grep -i "search.*query" mcp-debug.log`
- Errors: `grep -i error mcp-debug.log`

**Check system resources**:
```bash
# Monitor during operation
top -p $(pgrep "tp")

# Memory usage over time
while true; do
  ps -o pid,rss,vsz,comm -p $(pgrep "tp")
  sleep 5
done
```

## Getting Help

If these solutions don't resolve your issue:

1. **Gather diagnostic information**:
   - TurboProp version: `tp --version`
   - Operating system: `uname -a`
   - Available memory: `free -h` (Linux) or `vm_stat` (macOS)
   - Disk space: `df -h`

2. **Create a minimal reproduction**:
   - Try with a small test repository
   - Use default configuration
   - Document exact steps to reproduce

3. **File an issue** with:
   - Diagnostic information
   - Configuration files
   - Relevant log excerpts
   - Steps to reproduce the problem

See the [GitHub issues page](https://github.com/turboprop-org/turboprop/issues) for existing solutions and to report new problems.
```

### 5. Update Man Page

Update the man page to include MCP documentation:
```bash
# Add to install-man-pages.sh or equivalent
cat > tp-mcp.1 << 'EOF'
.TH TP-MCP 1 "2024" "TurboProp" "User Commands"
.SH NAME
tp-mcp \- start MCP server for semantic code search
.SH SYNOPSIS
.B tp mcp
[\fIOPTION\fR]...
.SH DESCRIPTION
Start a Model Context Protocol (MCP) server that provides real-time semantic search capabilities to coding agents like Claude Code, GitHub Copilot, Cursor, and Windsurf.

The MCP server automatically indexes files in the specified repository, watches for changes, and exposes a search tool via the MCP protocol.

.SH OPTIONS
.TP
\fB\-\-repo\fR \fIPATH\fR
Repository path to index and watch (default: current directory)
.TP
\fB\-\-model\fR \fIMODEL\fR
Embedding model to use for semantic search
.TP
\fB\-\-max\-filesize\fR \fISIZE\fR
Maximum file size to index (e.g., "2mb", "500kb")
.TP
\fB\-\-filter\fR \fIPATTERN\fR
Glob pattern for files to include (e.g., "*.rs", "src/**/*.js")
.TP
\fB\-\-filetype\fR \fITYPE\fR
Filter by file type (e.g., "rust", "javascript", "python")
.TP
\fB\-\-force\-rebuild\fR
Force rebuild of existing index
.TP
\fB\-v, \-\-verbose\fR
Enable verbose logging
.TP
\fB\-\-debug\fR
Enable debug-level logging

.SH EXAMPLES
.TP
\fBtp mcp \-\-repo .\fR
Start MCP server for current directory
.TP
\fBtp mcp \-\-repo /path/to/project \-\-verbose\fR
Start server with verbose logging for specific project
.TP
\fBtp mcp \-\-repo . \-\-filter "src/**/*.rs" \-\-force\-rebuild\fR
Index only Rust source files and rebuild index

.SH AGENT INTEGRATION
To integrate with coding agents, add the following to your agent's MCP configuration:

.B Claude Code (.claude.json):
.nf
{
  "mcpServers": {
    "turboprop": {
      "command": "tp",
      "args": ["mcp", "--repo", "."]
    }
  }
}
.fi

.B Cursor (.cursor/mcp.json):
.nf
{
  "mcpServers": {
    "turboprop": {
      "command": "tp",
      "args": ["mcp", "--repo", "."]
    }
  }
}
.fi

.SH SEARCH TOOL
The MCP server exposes a "search" tool with parameters:
.IP \[bu] 2
\fBquery\fR (required): Natural language search query
.IP \[bu] 2
\fBlimit\fR: Maximum results (default: 10)
.IP \[bu] 2
\fBthreshold\fR: Similarity threshold 0.0-1.0
.IP \[bu] 2
\fBfiletype\fR: File extension filter (e.g., ".rs")
.IP \[bu] 2
\fBfilter\fR: Glob pattern filter
.IP \[bu] 2
\fBinclude_content\fR: Include full content (default: true)
.IP \[bu] 2
\fBcontext_lines\fR: Context lines around matches

.SH CONFIGURATION
The server reads configuration from \fB.turboprop.yml\fR in the repository root. See \fBtp\fR(1) for configuration details.

.SH FILES
.TP
\fB.turboprop.yml\fR
Project configuration file
.TP
\fB~/.turboprop\-cache/\fR
Model cache directory

.SH SEE ALSO
.BR tp (1),
.BR tp-index (1),
.BR tp-search (1)

.SH AUTHOR
TurboProp Development Team

.SH REPORTING BUGS
Report bugs to <https://github.com/turboprop-org/turboprop/issues>
EOF
```

## Files to Create/Modify
- `README.md` - Add comprehensive MCP documentation
- `docs/MCP_GUIDE.md` - Detailed user guide
- `TROUBLESHOOTING.md` - Add MCP troubleshooting section
- `src/cli.rs` - Update help text
- `install-man-pages.sh` - Add MCP man page

## Acceptance Criteria
- [ ] README.md clearly explains MCP server functionality and setup
- [ ] MCP user guide provides comprehensive coverage of all features
- [ ] Troubleshooting documentation addresses common issues
- [ ] CLI help text is clear and informative
- [ ] Integration examples work for all major coding agents
- [ ] Documentation follows TurboProp's existing style and quality standards
- [ ] All examples are tested and functional
- [ ] Documentation is accessible to users new to MCP

## Success Validation
```bash
# Verify README includes MCP documentation
grep -q "MCP Server" README.md

# Check user guide exists and is comprehensive
test -f docs/MCP_GUIDE.md
wc -l docs/MCP_GUIDE.md  # Should be substantial

# Verify CLI help is updated
cargo run --bin tp -- mcp --help | grep -q "Model Context Protocol"

# Test example configurations
# (Manual testing with actual agents)

# Check man page generation
./install-man-pages.sh
man tp-mcp | head -20
```

## Notes
This step completes the MCP server implementation by:
- Providing comprehensive documentation for users at all levels
- Including clear setup instructions for all major coding agents
- Adding troubleshooting guidance for common issues
- Maintaining consistency with TurboProp's existing documentation style
- Ensuring the MCP server is fully accessible and usable

The documentation enables users to quickly get started with the MCP server while providing the depth needed for advanced usage and troubleshooting. This completes the implementation of the MCP server specification while maintaining TurboProp's high standards for user experience and documentation quality.

## Proposed Solution

I will implement comprehensive MCP server documentation by following a systematic approach that prioritizes user experience and maintains consistency with TurboProp's existing documentation patterns.

### Implementation Strategy

1. **Update README.md** - Add a dedicated MCP Server section with:
   - Quick start guide for immediate setup
   - Integration examples for all major coding agents
   - Core feature overview with clear benefits
   - Configuration examples and best practices
   - Links to detailed documentation

2. **Create docs/MCP_GUIDE.md** - Comprehensive user guide covering:
   - Installation and setup prerequisites
   - Detailed agent integration for Claude Code, Cursor, GitHub Copilot, Windsurf
   - Configuration management with .turboprop.yml examples
   - Advanced features like model selection and file filtering
   - Performance optimization guidelines
   - Best practices for team usage
   - FAQ section addressing common questions

3. **Enhance TROUBLESHOOTING.md** - Add MCP-specific troubleshooting:
   - Server startup issues and solutions
   - Agent integration problems
   - Search result quality issues
   - Performance optimization techniques  
   - File watching problems
   - Debug logging and diagnostic procedures

4. **Update CLI Help Text** - Enhance src/cli.rs with:
   - Clear MCP command descriptions
   - Usage examples for common scenarios
   - Links to detailed documentation
   - Best practices guidance

5. **Create MCP Man Page** - Add tp-mcp.1 manual page with:
   - Complete option documentation
   - Agent integration examples
   - Configuration file references
   - Cross-references to related commands

### Testing and Validation

- Use Test Driven Development to ensure all examples work correctly
- Validate documentation against acceptance criteria
- Test integration examples with actual coding agents where possible
- Ensure consistency with existing TurboProp documentation style
- Verify all links and references are correct

This approach ensures users at all levels can successfully set up and use the MCP server while maintaining TurboProp's high documentation standards.